

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="GeorgyKwe">
  <meta name="keywords" content="">
  
    <meta name="description" content="配置基础环境以下步骤在主机侧部署，控制节点和计算节点环境均在Ubuntu 22.04。 节点拓扑图  网络拓扑    序号 主机 接口 网卡名    1 controller：10.100.192.79 内部接口 enp2s0   1 controller：10.100.192.92 外部接口 enxf8e43b63eb2f   2 compute2：10.100.192.94 内部接口 eno1">
<meta property="og:type" content="article">
<meta property="og:title" content="部署双节点X86OpenStack集群">
<meta property="og:url" content="http://example.com/2023/08/10/%E9%83%A8%E7%BD%B2%E5%8F%8C%E8%8A%82%E7%82%B9X86OpenStack%E9%9B%86%E7%BE%A4/index.html">
<meta property="og:site_name" content="我与我斗争">
<meta property="og:description" content="配置基础环境以下步骤在主机侧部署，控制节点和计算节点环境均在Ubuntu 22.04。 节点拓扑图  网络拓扑    序号 主机 接口 网卡名    1 controller：10.100.192.79 内部接口 enp2s0   1 controller：10.100.192.92 外部接口 enxf8e43b63eb2f   2 compute2：10.100.192.94 内部接口 eno1">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/image/%E8%8A%82%E7%82%B9%E6%8B%93%E6%89%91%E5%9B%BE.png">
<meta property="article:published_time" content="2023-08-10T08:42:09.000Z">
<meta property="article:modified_time" content="2023-08-10T12:04:22.477Z">
<meta property="article:author" content="GeorgyKwe">
<meta property="article:tag" content="整理">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/image/%E8%8A%82%E7%82%B9%E6%8B%93%E6%89%91%E5%9B%BE.png">
  
  
  
  <title>部署双节点X86OpenStack集群 - 我与我斗争</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>我与我斗争</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="部署双节点X86OpenStack集群"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-08-10 16:42" pubdate>
          2023年8月10日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          36k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          299 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">部署双节点X86OpenStack集群</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="配置基础环境"><a href="#配置基础环境" class="headerlink" title="配置基础环境"></a>配置基础环境</h1><p>以下步骤在主机侧部署，控制节点和计算节点环境均在Ubuntu 22.04。</p>
<p><strong>节点拓扑图</strong></p>
<p><img src="/../image/%E8%8A%82%E7%82%B9%E6%8B%93%E6%89%91%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt="节点拓扑图"></p>
<p><strong>网络拓扑</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">主机</th>
<th align="center">接口</th>
<th align="center">网卡名</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">controller：10.100.192.79</td>
<td align="center">内部接口</td>
<td align="center">enp2s0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">controller：10.100.192.92</td>
<td align="center">外部接口</td>
<td align="center">enxf8e43b63eb2f</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">compute2：10.100.192.94</td>
<td align="center">内部接口</td>
<td align="center">eno1</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">compute2：10.100.192.93</td>
<td align="center">外部接口</td>
<td align="center">enx00e04c680218</td>
</tr>
</tbody></table>
<h3 id="更新Ubuntu源"><a href="#更新Ubuntu源" class="headerlink" title="更新Ubuntu源"></a>更新Ubuntu源</h3><p>选择阿里云源22.04版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Bash">deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-security main restrcdicted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse<br></code></pre></td></tr></table></figure>

<h2 id="一、基础环境（2台高性能开发机）"><a href="#一、基础环境（2台高性能开发机）" class="headerlink" title="一、基础环境（2台高性能开发机）"></a>一、基础环境（2台高性能开发机）</h2><h3 id="1、关闭防火墙及修改内核"><a href="#1、关闭防火墙及修改内核" class="headerlink" title="1、关闭防火墙及修改内核"></a>1、关闭防火墙及修改内核</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo -i<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">ufw <span class="hljs-built_in">disable</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;net.bridge.bridge-nf-call-ip6tables = 1&#x27;</span> &gt;&gt; /etc/sysctl.d/99-sysctl.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;net.bridge.bridge-nf-call-iptables = 1&#x27;</span> &gt;&gt; /etc/sysctl.d/99-sysctl.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;net.ipv6.conf.all.disable_ipv6 = 1&#x27;</span> &gt;&gt; /etc/sysctl.d/99-sysctl.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">modprobe br_netfilter<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sysctl --system<br></code></pre></td></tr></table></figure>

<h3 id="2、修改-etc-hosts"><a href="#2、修改-etc-hosts" class="headerlink" title="2、修改  /etc/hosts"></a>2、修改  <code>/etc/hosts</code></h3><p>各节点下执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hostnamectl set-hostname controller<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;10.100.192.79  controller&#x27;</span>  &gt;&gt; /etc/hosts<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;10.100.192.94  compute2&#x27;</span>  &gt;&gt; /etc/hosts<br></code></pre></td></tr></table></figure>

<h3 id="3、安装软件包"><a href="#3、安装软件包" class="headerlink" title="3、安装软件包"></a>3、安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt update<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install -y net-tools bash-completion python3-openstackclient wget chrony<br></code></pre></td></tr></table></figure>

<h3 id="4、配置时间同步"><a href="#4、配置时间同步" class="headerlink" title="4、配置时间同步"></a>4、配置时间同步</h3><p>集群环境时刻要求每个节点的时间一致，一般由时钟同步软件保证。本文使用<code>chrony</code>软件。步骤如下：</p>
<p><strong>controller</strong></p>
<p>1、 安装服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo apt update<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo apt install -y chrony<br></code></pre></td></tr></table></figure>

<p>2、修改 <code>/etc/chrony/chrony.conf</code> 配置文件，新增一行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/chrony/chrony.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 表示允许哪些IP从本节点同步时钟</span><br>allow 10.100.192.0/24<br></code></pre></td></tr></table></figure>

<p>3、重启服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo service chrony restart<br></code></pre></td></tr></table></figure>

<p><strong>compute2</strong></p>
<p>1、安装服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo apt update<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo apt install -y chrony<br></code></pre></td></tr></table></figure>

<p>2、修改 <code>/etc/chrony.conf</code> 配置文件，新增一行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># NTP_SERVER 是controller IP，表示从这个机器获取时间，这里我们填 192.168.0.2，或者在`/etc/hosts`里配置好的 controller 名字即可。</span><br>server NTP_SERVER iburst<br></code></pre></td></tr></table></figure>

<blockquote>
<p>同时，要把<code>pool pool.ntp.org iburst</code>这一行注释掉，表示不从公网同步时钟。</p>
</blockquote>
<p>3、重启服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo service chrony restart<br></code></pre></td></tr></table></figure>

<p><strong>验证</strong></p>
<p>配置完成后，检查一下结果，在其他非controller节点执行<code>chronyc sources</code>，返回结果类似如下内容，表示成功从controller同步时钟。</p>
<h2 id="二、openstack安装（Controller）"><a href="#二、openstack安装（Controller）" class="headerlink" title="二、openstack安装（Controller）"></a>二、openstack安装（Controller）</h2><p>通过 <a target="_blank" rel="noopener" href="https://docs.openstack.org/install-guide/environment-packages-ubuntu.html#archive-enablement">OpenStack packages for Ubuntu</a> 查看对应版本，22.04的默认版本为OpenStack Yoga。使用这个版本无需添加配置。如果其他版本自行修改。</p>
<h3 id="1、安装Mariadb数据库"><a href="#1、安装Mariadb数据库" class="headerlink" title="1、安装Mariadb数据库"></a>1、安装Mariadb数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install mariadb-server python3-pymysql -y<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cat</span> &gt; /etc/mysql/mariadb.conf.d/99-openstack.cnf  &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[mysqld]</span><br><span class="hljs-string">bind-address = 10.100.192.79</span><br><span class="hljs-string">default-storage-engine = innodb</span><br><span class="hljs-string">innodb_file_per_table = on</span><br><span class="hljs-string">max_connections = 4096</span><br><span class="hljs-string">collation-server = utf8_general_ci</span><br><span class="hljs-string">character-set-server = utf8</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<p>重启服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service mysql restart<br></code></pre></td></tr></table></figure>

<p>通过运行<code>mysql_secure_installation</code> 脚本来保护数据库服务。特别是，为数据库root帐户选择一个合适的密码 ：（设置数据库密码为<code>000000</code>）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">mysql_secure_installation<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">netstat -antup | grep mariadb<br></code></pre></td></tr></table></figure>

<p>检查能否登录Mariadb</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql -u root -p<br></code></pre></td></tr></table></figure>

<h3 id="2、安装Rabbitmq消息队列"><a href="#2、安装Rabbitmq消息队列" class="headerlink" title="2、安装Rabbitmq消息队列"></a>2、安装Rabbitmq消息队列</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install rabbitmq-server -y<br></code></pre></td></tr></table></figure>

<p>添加OpenStack用户，用户密码设置为<code>000000</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">rabbitmqctl add_user openstack 000000<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">rabbitmqctl set_user_tags openstack administrator<br></code></pre></td></tr></table></figure>

<p>替换RABBIT_PASS为合适的密码。 允许用户的配置、写入和读取访问权限 OpenStack：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">rabbitmqctl set_permissions openstack <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">rabbitmqctl list_user_permissions openstack<br></code></pre></td></tr></table></figure>

<p>添加可视化插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_management<br></code></pre></td></tr></table></figure>

<p>登录<code>rabbitmq</code>,登录地址：<a target="_blank" rel="noopener" href="http://ip:15672/">http://localhost:15672</a></p>
<p>可通过<code>guest</code>登录，密码：<code>guest</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">netstat  -antup | grep 5672<br></code></pre></td></tr></table></figure>

<p>重启消息队列服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service rabbitmq-server restart<br></code></pre></td></tr></table></figure>

<h3 id="3、安装MemCached内存缓存处理"><a href="#3、安装MemCached内存缓存处理" class="headerlink" title="3、安装MemCached内存缓存处理"></a>3、安装MemCached内存缓存处理</h3><p>服务的身份服务认证机制使用 Memcached 来缓存令牌。memcached 服务通常在控制器节点上运行。对于生产部署，我们建议启用防火墙、身份验证和加密的组合来保护它。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install -y memcached python3-memcache<br></code></pre></td></tr></table></figure>

<blockquote>
<p>编辑 <code>/etc/memcached.conf</code> 文件并将服务配置为使用控制器节点的管理 IP 地址。这是为了允许其他节点通过管理网络进行访问修改：将 <code>-l</code> 后面的IP改为如下 <code>-l IP</code> 地址。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sed -i <span class="hljs-string">&#x27;s/-l 127.0.0.1/-l 10.100.192.79/g&#x27;</span> /etc/memcached.conf<br></code></pre></td></tr></table></figure>

<p>重启 Memcached 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service memcached restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">netstat -antup | grep memcached<br></code></pre></td></tr></table></figure>

<h3 id="4、安装etcd分布式键值存储"><a href="#4、安装etcd分布式键值存储" class="headerlink" title="4、安装etcd分布式键值存储"></a>4、安装etcd分布式键值存储</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install etcd -y<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cat</span> &gt;  /etc/default/etcd  &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">ETCD_NAME=&quot;controller&quot;</span><br><span class="hljs-string">ETCD_DATA_DIR=&quot;/var/lib/etcd&quot;</span><br><span class="hljs-string">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="hljs-string">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster-01&quot;</span><br><span class="hljs-string">ETCD_INITIAL_CLUSTER=&quot;controller=http://10.100.192.79:2380&quot;</span><br><span class="hljs-string">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://10.100.192.79:2380&quot;</span><br><span class="hljs-string">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://10.100.192.79:2379&quot;</span><br><span class="hljs-string">ETCD_LISTEN_PEER_URLS=&quot;http://0.0.0.0:2380&quot;</span><br><span class="hljs-string">ETCD_LISTEN_CLIENT_URLS=&quot;http://10.100.192.79:2379&quot;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service etcd restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">netstat -antup | grep etcd<br></code></pre></td></tr></table></figure>

<h3 id="5、安装keystone"><a href="#5、安装keystone" class="headerlink" title="5、安装keystone"></a>5、安装keystone</h3><p>以root用户身份连接数据库服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo su<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">mysql<br></code></pre></td></tr></table></figure>

<p>以下步骤在root数据库环境执行</p>
<p>创建keystone数据库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">CREATE DATABASE keystone;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON keystone.* TO <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON keystone.* TO <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<p>退出数据库访问客户端。</p>
<p>运行以下命令来安装软件包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install keystone libapache2-mod-wsgi-py3 -y<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/keystone/keystone.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改如下</span><br>[database]<br>connection = mysql+pymysql://keystone:000000@controller/keystone<br><br>[token]<br>provider = fernet<br></code></pre></td></tr></table></figure>

<p>填充身份服务数据库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;keystone-manage db_sync&quot;</span> keystone<br></code></pre></td></tr></table></figure>

<p>初始化 Fernet 密钥库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone<br></code></pre></td></tr></table></figure>

<p>引导身份服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Bash">keystone-manage bootstrap --bootstrap-password 000000 \<br>  --bootstrap-admin-url http://controller:5000/v3/ \<br>  --bootstrap-internal-url http://controller:5000/v3/ \<br>  --bootstrap-public-url http://controller:5000/v3/ \<br>  --bootstrap-region-id RegionOne<br></code></pre></td></tr></table></figure>

<p>配置 Apache HTTP 服务器</p>
<p>编辑 <code>/etc/apache2/apache2.conf</code> 文件并配置 <code>ServerName</code> 选项以引用控制器节点：如果该 <code>ServerName</code> 条目尚不存在，则需要添加该条目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ServerName controller&#x27;</span> &gt;&gt;  /etc/apache2/apache2.conf<br></code></pre></td></tr></table></figure>

<p>安全部署应将 Web 服务器配置为使用 SSL 或在 SSL 终结器后面运行。<br>重启Apache服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service apache2 restart<br></code></pre></td></tr></table></figure>

<p>检查状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service apache2 status<br></code></pre></td></tr></table></figure>

<p>后续所有service都可通过status命令检查重启状态，后面不再重复，请自行检查配置的服务是否重启成功。</p>
<p>配置keystone管理员的环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">export</span> OS_USERNAME=admin<br><span class="hljs-built_in">export</span> OS_PASSWORD=000000<br><span class="hljs-built_in">export</span> OS_PROJECT_NAME=admin<br><span class="hljs-built_in">export</span> OS_USER_DOMAIN_NAME=Default<br><span class="hljs-built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default<br><span class="hljs-built_in">export</span> OS_AUTH_URL=http://controller:5000/v3<br><span class="hljs-built_in">export</span> OS_IDENTITY_API_VERSION=3<br></code></pre></td></tr></table></figure>

<p>创建域、项目、keystone用户和角色</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack domain create --description <span class="hljs-string">&quot;An Example Domain&quot;</span> example<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack project create --domain default --description <span class="hljs-string">&quot;Service Project&quot;</span> service<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack project create --domain default --description <span class="hljs-string">&quot;Demo Project&quot;</span> demo<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack user create --domain default --password-prompt demo<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack role create user<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack role add --project demo --user demo user<br></code></pre></td></tr></table></figure>

<p>验证keystone</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">unset</span> OS_AUTH_URL OS_PASSWORD<br></code></pre></td></tr></table></figure>

<p>获取keystone管理员的令牌</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack --os-auth-url http://controller:5000/v3 \<br>  --os-project-domain-name Default --os-user-domain-name Default \<br>  --os-project-name admin --os-username admin token issue<br></code></pre></td></tr></table></figure>

<p>输入Password：<code>000000</code></p>
<p>获取令牌，keystone正常</p>
<p>获取keystone普通用户demo的令牌</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack --os-auth-url http://controller:5000/v3 \<br>  --os-project-domain-name Default --os-user-domain-name Default \<br>  --os-project-name demo --os-username demo token issue<br></code></pre></td></tr></table></figure>

<p>创建openstack客户端环境变量脚本文件</p>
<p>前面的部分使用环境变量和命令选项的组合通过openstack客户端与身份服务进行交互 。为了提高客户端操作的效率，OpenStack支持简单的客户端环境脚本，也称为 OpenRC 文件。这些脚本通常包含所有客户端的通用选项，但也支持独特的选项。创建客户端环境的脚本admin和demo 项目和用户。本指南的后续部分将参考这些脚本来加载客户端操作的适当凭据。</p>
<p>admin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cat</span> &gt; admin-openrc  &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="hljs-string">export OS_USER_DOMAIN_NAME=Default</span><br><span class="hljs-string">export OS_PROJECT_NAME=admin</span><br><span class="hljs-string">export OS_USERNAME=admin</span><br><span class="hljs-string">export OS_PASSWORD=000000</span><br><span class="hljs-string">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="hljs-string">export OS_IDENTITY_API_VERSION=3</span><br><span class="hljs-string">export OS_IMAGE_API_VERSION=2</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<p>demo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cat</span> &gt; demo-openrc  &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="hljs-string">export OS_USER_DOMAIN_NAME=Default</span><br><span class="hljs-string">export OS_PROJECT_NAME=demo</span><br><span class="hljs-string">export OS_USERNAME=demo</span><br><span class="hljs-string">export OS_PASSWORD=000000</span><br><span class="hljs-string">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="hljs-string">export OS_IDENTITY_API_VERSION=3</span><br><span class="hljs-string">export OS_IMAGE_API_VERSION=2</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">source</span> admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack token issue<br></code></pre></td></tr></table></figure>

<h3 id="6、安装glance"><a href="#6、安装glance" class="headerlink" title="6、安装glance"></a>6、安装glance</h3><p>创建数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">mysql<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">CREATE DATABASE glance;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON glance.* TO <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON glance.* TO <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<p>退出数据库访问客户端</p>
<p>创建用户并授权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack user create --domain default --password-prompt glance<br></code></pre></td></tr></table></figure>

<p>在server项目中给用户glance授予管理员权限admin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack role add --project service --user glance admin<br></code></pre></td></tr></table></figure>

<p>创建服务类型为image的实体glance</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack service create --name glance  --description <span class="hljs-string">&quot;OpenStack Image&quot;</span> image<br></code></pre></td></tr></table></figure>

<p>创建镜像服务的调用端点</p>
<p>为image服务类型创建公开（public）的调用端点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne image public http://controller:9292<br></code></pre></td></tr></table></figure>

<p>为image服务类型创建内部（internal）的调用端点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne image internal http://controller:9292<br></code></pre></td></tr></table></figure>

<p>为image服务类型创建管理（admin）的调用端点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne image admin http://controller:9292<br></code></pre></td></tr></table></figure>

<p>安装并配置相关软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install glance -y<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/glance/glance-api.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改如下</span><br>[database]<br>connection = mysql+pymysql://glance:000000@controller/glance<br><br>[keystone_authtoken]<br>www_authenticate_uri = http://controller:5000<br>auth_url = http://controller:5000<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = glance<br>password = 000000<br><br>[paste_deploy]<br>flavor = keystone<br><br>[glance_store]<br>stores = file,http<br>default_store = file<br>filesystem_store_datadir = /var/lib/glance/images/<br></code></pre></td></tr></table></figure>

<p>向数据库中导入glance的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;glance-manage db_sync&quot;</span> glance<br></code></pre></td></tr></table></figure>

<p>启动glance服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service glance-api restart<br></code></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<p>下载镜像到<code>/root</code>目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img<br></code></pre></td></tr></table></figure>

<p>使用QCOW2磁盘格式、裸容器格式和公开可见性将镜像上传到 Image 服务 ，以便所有项目都可以访问它：执行成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">glance image-create --name <span class="hljs-string">&quot;cirros&quot;</span> --file cirros-0.4.0-x86_64-disk.img \<br>--disk-format qcow2 --container-format bare  --visibility=public<br></code></pre></td></tr></table></figure>

<p>OpenStack 动态生成 ID，因此您将在示例命令输出中看到不同的值。</p>
<p>确认上传镜像并验证属性：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">glance image-list<br></code></pre></td></tr></table></figure>

<h3 id="7、安装placement"><a href="#7、安装placement" class="headerlink" title="7、安装placement"></a>7、安装placement</h3><p>创建数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">mysql<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">CREATE DATABASE placement;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON placement.* TO <span class="hljs-string">&#x27;placement&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON placement.* TO <span class="hljs-string">&#x27;placement&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<p>创建用户并授权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack user create --domain default --password-prompt placement<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack role add --project service --user placement admin<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack service create --name placement --description <span class="hljs-string">&quot;Placement API&quot;</span> placement<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne placement public http://controller:8778<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne placement internal http://controller:8778<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne placement admin http://controller:8778<br></code></pre></td></tr></table></figure>

<p>安装并配置相关软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install placement-api -y<br></code></pre></td></tr></table></figure>

<p>编辑 <code>/etc/placement/placement.conf</code> 文件并完成以下操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/placement/placement.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 增加如下</span><br>[placement_database]<br>connection = mysql+pymysql://placement:000000@controller/placement<br><br>[api]<br>auth_strategy = keystone<br><br>[keystone_authtoken]<br>auth_url = http://controller:5000/v3<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = placement<br>password = 000000<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;placement-manage db sync&quot;</span> placement<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service apache2 restart<br></code></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">placement-status upgrade check<br></code></pre></td></tr></table></figure>

<h3 id="安装osc-placement插件"><a href="#安装osc-placement插件" class="headerlink" title="安装osc-placement插件"></a>安装osc-placement插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">pip3 install osc-placement<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack --os-placement-api-version 1.2 resource class list --sort-column name<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack --os-placement-api-version 1.6 trait list --sort-column name<br></code></pre></td></tr></table></figure>

<h3 id="8、安装-nova"><a href="#8、安装-nova" class="headerlink" title="8、安装 nova"></a>8、安装 nova</h3><p><strong>controller</strong></p>
<p>创建数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">mysql<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">CREATE DATABASE nova_api;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">CREATE DATABASE nova;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">CREATE DATABASE nova_cell0;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON nova_api.* TO <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON nova_api.* TO <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON nova.* TO <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON nova.* TO <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack user create --domain default --password-prompt nova<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack role add --project service --user nova admin<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack service create --name nova --description <span class="hljs-string">&quot;OpenStack Compute&quot;</span> compute<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1<br></code></pre></td></tr></table></figure>

<p>安装并配置相关软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install nova-api nova-conductor nova-novncproxy nova-scheduler -y<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 增加内容</span><br>[DEFAULT]<br>transport_url = rabbit://openstack:000000@controller:5672/<br>my_ip = 10.100.192.79<br><br>[api_database]<br>connection = mysql+pymysql://nova:000000@controller/nova_api<br><br>[database]<br>connection = mysql+pymysql://nova:000000@controller/nova<br><br>[api]<br>auth_strategy = keystone<br><br>[keystone_authtoken]<br>www_authenticate_uri = http://controller:5000/<br>auth_url = http://controller:5000/<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = nova<br>password = 000000<br><br>[vnc]<br>enabled = <span class="hljs-literal">true</span><br>server_listen = <span class="hljs-variable">$my_ip</span><br>server_proxyclient_address = <span class="hljs-variable">$my_ip</span><br><br>[glance]<br>api_servers = http://controller:9292<br><br>[oslo_concurrency]<br>lock_path = /var/lib/nova/tmp<br><br>[placement]<br>region_name = RegionOne<br>project_domain_name = Default<br>project_name = service<br>auth_type = password<br>user_domain_name = Default<br>auth_url = http://controller:5000/v3<br>username = placement<br>password = 000000<br><br>[scheduler]<br>discover_hosts_in_cells_interval = 300<br><br></code></pre></td></tr></table></figure>

<p>向数据库中导入nova，nova-api，nova-cell0的数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage api_db sync&quot;</span> nova<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage cell_v2 map_cell0&quot;</span> nova<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot;</span> nova<br></code></pre></td></tr></table></figure>

<p>检查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage db sync&quot;</span> nova<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage cell_v2 list_cells&quot;</span> nova<br></code></pre></td></tr></table></figure>

<p>重启所有服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-api restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-scheduler restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-conductor restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-novncproxy restart<br></code></pre></td></tr></table></figure>

<p>查看所有状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-api status &amp;&amp; service nova-scheduler status &amp;&amp; service nova-conductor status &amp;&amp; service nova-novncproxy status<br></code></pre></td></tr></table></figure>

<p><strong>compute1(OpenEuler X86)</strong></p>
<p>1、安装软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dnf install openstack-nova-compute<br></code></pre></td></tr></table></figure>

<p>2、编辑<code>/etc/nova/nova.conf</code>配置文件</p>
<p>在[default]部分，启用计算和元数据的API，配置RabbitMQ消息队列入口，使用Compute节点管理IP配置my_ip，显式定义compute_driver、instances_path、log_dir：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[DEFAULT]<br>enabled_apis = osapi_compute,metadata<br>transport_url = rabbit://openstack:000000@controller:5672/<br>my_ip = 10.12.193.53<br>compute_driver = libvirt.LibvirtDriver<br>instances_path = /var/lib/nova/instances<br>log_dir = /var/log/nova<br></code></pre></td></tr></table></figure>

<p>在[api]和[keystone_authtoken]部分，配置身份认证服务入口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[api]<br>auth_strategy = keystone<br><br>[keystone_authtoken]<br>auth_url = http://controller:5000/v3<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = nova<br>password = 000000<br></code></pre></td></tr></table></figure>

<p>在[vnc]部分，启用并配置远程控制台入口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[vnc]<br>enabled = <span class="hljs-literal">true</span><br>server_listen = <span class="hljs-variable">$my_ip</span><br>server_proxyclient_address = <span class="hljs-variable">$my_ip</span><br>novncproxy_base_url = http://controller:6080/vnc_auto.html<br></code></pre></td></tr></table></figure>

<p>在[glance]部分，配置镜像服务API的地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[glance]<br>api_servers = http://controller:9292<br></code></pre></td></tr></table></figure>

<p>在[oslo_concurrency]部分，配置lock path：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[oslo_concurrency]<br>lock_path = /var/lib/nova/tmp<br></code></pre></td></tr></table></figure>

<p>[placement]部分，配置placement服务的入口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[placement]<br>region_name = RegionOne<br>project_domain_name = Default<br>project_name = service<br>auth_type = password<br>user_domain_name = Default<br>auth_url = http://controller:5000/v3<br>username = placement<br>password = 000000<br></code></pre></td></tr></table></figure>

<p>3、确认计算节点是否支持虚拟机硬件加速（x86_64）</p>
<p>处理器为x86_64架构时，可通过运行如下命令确认是否支持硬件加速：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">egrep -c <span class="hljs-string">&#x27;(vmx|svm)&#x27;</span> /proc/cpuinfo<br></code></pre></td></tr></table></figure>

<p>如果返回值为0则不支持硬件加速，需要配置libvirt使用QEMU而不是默认的KVM。编辑&#x2F;etc&#x2F;nova&#x2F;nova.conf的[libvirt]部分：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[libvirt]<br>virt_type = qemu<br>如果返回值为1或更大的值，则支持硬件加速，不需要进行额外的配置。<br></code></pre></td></tr></table></figure>

<p>4、启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x /etc/rc.d/rc.local<br>systemctl <span class="hljs-built_in">enable</span> libvirtd.service openstack-nova-compute.service<br>systemctl start libvirtd.service openstack-nova-compute.service<br></code></pre></td></tr></table></figure>

<p><strong>compute2（Ubuntu）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install nova-compute -y<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 增加内容</span><br>[DEFAULT]<br>transport_url = rabbit://openstack:000000@controller<br>my_ip = 10.100.192.94<br><br>[api]<br>auth_strategy = keystone<br><br>[keystone_authtoken]<br>www_authenticate_uri = http://controller:5000/<br>auth_url = http://controller:5000/<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = nova<br>password = 000000<br><br>[vnc]<br>enabled = <span class="hljs-literal">true</span><br>server_listen = <span class="hljs-variable">$my_ip</span><br>server_proxyclient_address = <span class="hljs-variable">$my_ip</span><br>novncproxy_base_url = http://controller:6080/vnc_auto.html<br><br>[glance]<br>api_servers = http://controller:9292<br><br>[oslo_concurrency]<br>lock_path = /var/lib/nova/tmp<br><br>[placement]<br>region_name = RegionOne<br>project_domain_name = Default<br>project_name = service<br>auth_type = password<br>user_domain_name = Default<br>auth_url = http://controller:5000/v3<br>username = placement<br>password = 000000<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-compute restart<br></code></pre></td></tr></table></figure>

<p><strong>controller</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack compute service list --service nova-compute<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span> nova<br></code></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack compute service list<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack catalog list<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack image list<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">nova-status upgrade check<br></code></pre></td></tr></table></figure>

<h3 id="9、安装neutron"><a href="#9、安装neutron" class="headerlink" title="9、安装neutron"></a>9、安装neutron</h3><p><strong>controller</strong></p>
<p>创建数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">mysql<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">CREATE DATABASE neutron;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON neutron.* TO <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>  IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GRANT ALL PRIVILEGES ON neutron.* TO <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;000000&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack user create --domain default --password-prompt neutron<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack role add --project service --user neutron admin<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack service create --name neutron --description <span class="hljs-string">&quot;OpenStack Networking&quot;</span> network<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne network public http://controller:9696<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne network internal http://controller:9696<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack endpoint create --region RegionOne network admin http://controller:9696<br></code></pre></td></tr></table></figure>

<p>安装并配置相关软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install neutron-server neutron-plugin-ml2 \<br>  neutron-linuxbridge-agent neutron-l3-agent neutron-dhcp-agent \<br>  neutron-metadata-agent -y<br></code></pre></td></tr></table></figure>

<p>配置服务器组件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/neutron/neutron.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[DEFAULT]<br>core_plugin = ml2<br>service_plugins = router<br>allow_overlapping_ips = <span class="hljs-literal">true</span><br>transport_url = rabbit://openstack:000000@controller<br>auth_strategy = keystone<br>notify_nova_on_port_status_changes = <span class="hljs-literal">true</span><br>notify_nova_on_port_data_changes = <span class="hljs-literal">true</span><br><br>[database]<br>connection = mysql+pymysql://neutron:000000@controller/neutron<br><br>[keystone_authtoken]<br>www_authenticate_uri = http://controller:5000<br>auth_url = http://controller:5000<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = neutron<br>password = 000000<br><br>[nova]<br>auth_url = http://controller:5000<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = nova<br>password = 000000<br><br>[oslo_concurrency]<br>lock_path = /var/lib/neutron/tmp<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/neutron/plugins/ml2/ml2_conf.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[ml2]<br>type_drivers = flat,vlan,vxlan<br>tenant_network_types = flat<br>mechanism_drivers = linuxbridge,l2population<br>extension_drivers = port_security<br><br>[ml2_type_flat]<br>flat_networks = provider<br><br>[ml2_type_vxlan]<br>vni_ranges = 1:1000<br><br>[securitygroup]<br>enable_ipset = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/neutron/plugins/ml2/linuxbridge_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[linux_bridge]<br>physical_interface_mappings = provider:enxf8e43b63eb2f<br><br>[vxlan]<br>enable_vxlan = <span class="hljs-literal">false</span><br>local_ip = 10.100.192.79<br>l2_population = <span class="hljs-literal">true</span><br><br>[securitygroup]<br>enable_security_group = <span class="hljs-literal">true</span><br>firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/neutron/l3_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[DEFAULT]<br>interface_driver = linuxbridge<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/neutron/dhcp_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[DEFAULT]<br>interface_driver = linuxbridge<br>dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq<br>enable_isolated_metadata = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/neutron/metadata_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[DEFAULT]<br>nova_metadata_host = controller<br>metadata_proxy_shared_secret = 000000<br></code></pre></td></tr></table></figure>

<p>配置Compute 服务以使用Networking 服务</p>
<p>必须安装 Nova 计算服务才能完成此步骤。</p>
<p>编辑<code>/etc/nova/nova.conf</code>文件并执行以下操作：</p>
<p>在该[neutron]部分中，配置访问参数，启用元数据代理，并配置密钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br><br>[neutron]<br>auth_url = http://controller:5000<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = 000000<br>service_metadata_proxy = <span class="hljs-literal">true</span><br>metadata_proxy_shared_secret = 000000<br></code></pre></td></tr></table></figure>

<p>向数据库中导入neutron的数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">su -s /bin/sh -c <span class="hljs-string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</span><br><span class="hljs-string">--config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span> neutron<br></code></pre></td></tr></table></figure>

<p>由于脚本需要完整的服务器和插件配置文件，因此 Networking 的数据库填充发生在</p>
<p>重启计算 API 服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-api restart<br></code></pre></td></tr></table></figure>

<p>重新启动网络服务。<br>对于两个网络选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service neutron-server restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service neutron-linuxbridge-agent restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service neutron-dhcp-agent restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service neutron-metadata-agent restart<br></code></pre></td></tr></table></figure>

<p>对于网络选项 2，还要重新启动第 3 层服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service neutron-l3-agent restart<br></code></pre></td></tr></table></figure>

<p>执行命令查看neutron安装是否成功 -无结果，没有成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack network agent list<br></code></pre></td></tr></table></figure>

<p><strong>compute1(OpenEuler X86)</strong></p>
<ol>
<li>安装软件包</li>
</ol>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dnf install openstack-neutron-linuxbridge ebtables ipset -y<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>配置Neutron</li>
</ol>
<p>修改<code>/etc/neutron/neutron.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[DEFAULT]<br>transport_url = rabbit://openstack:000000@controller<br>auth_strategy = keystone<br><br>[keystone_authtoken]<br>www_authenticate_uri = http://controller:5000<br>auth_url = http://controller:5000<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = neutron<br>password = 000000<br><br>[oslo_concurrency]<br>lock_path = /var/lib/neutron/tmp<br></code></pre></td></tr></table></figure>

<p>修改 <code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[linux_bridge]<br>physical_interface_mappings = provider:ens3<br><br>[vxlan]<br>enable_vxlan = <span class="hljs-literal">true</span><br>local_ip = 10.12.193.53<br>l2_population = <span class="hljs-literal">true</span><br><br>[securitygroup]<br>enable_security_group = <span class="hljs-literal">true</span><br>firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver<br></code></pre></td></tr></table></figure>

<p>配置nova compute服务使用neutron，修改<code>/etc/nova/nova.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[neutron]<br>auth_url = http://controller:5000<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = 000000<br></code></pre></td></tr></table></figure>

<p>重启nova-compute服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart openstack-nova-compute.service<br></code></pre></td></tr></table></figure>

<p>启动Neutron linuxbridge agent服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> neutron-linuxbridge-agent<br>systemctl start neutron-linuxbridge-agent<br></code></pre></td></tr></table></figure>

<p><strong>compute2</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install neutron-linuxbridge-agent -y<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vim /etc/neutron/neutron.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[DEFAULT]<br>core_plugin = ml2<br>transport_url = rabbit://openstack:000000@controller<br>auth_strategy = keystone<br><br>[keystone_authtoken]<br>www_authenticate_uri = http://controller:5000<br>auth_url = http://controller:5000<br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = neutron<br>password = 000000<br><br>[oslo_concurrency]<br>lock_path = /var/lib/neutron/tmp<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/neutron/plugins/ml2/linuxbridge_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[linux_bridge]<br>physical_interface_mappings = provider:enx00e04c680218<br><br>[vxlan]<br>enable_vxlan = <span class="hljs-literal">false</span><br>local_ip = 10.100.192.94<br>l2_population = <span class="hljs-literal">true</span><br><br>[securitygroup]<br>enable_security_group = <span class="hljs-literal">true</span><br>firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 修改内容</span><br>[neutron]<br>auth_url = http://controller:5000<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = 000000<br></code></pre></td></tr></table></figure>

<p>重启计算服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service nova-compute restart<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service neutron-linuxbridge-agent restart<br></code></pre></td></tr></table></figure>

<p>验证</p>
<p><strong>controller</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack network agent list<br></code></pre></td></tr></table></figure>

<h3 id="10、安装dashboard"><a href="#10、安装dashboard" class="headerlink" title="10、安装dashboard"></a>10、安装dashboard</h3><p>安装并配置相关软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">apt install openstack-dashboard -y<br></code></pre></td></tr></table></figure>

<p>修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">vi /etc/openstack-dashboard/local_settings.py<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 搜索&#x27;OPENSTACK_HOST&#x27;并修改如下</span><br>OPENSTACK_HOST = <span class="hljs-string">&quot;10.100.192.92&quot;</span><br><br><span class="hljs-comment"># 搜索&#x27;LOCATION&#x27;并修改如下</span><br><span class="hljs-string">&#x27;LOCATION&#x27;</span>: <span class="hljs-string">&#x27;controller:11211&#x27;</span>,<br><br><span class="hljs-comment"># 搜索&#x27;TIME_ZONE&#x27;并修改如下 </span><br>TIME_ZONE = <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br><br>OPENSTACK_KEYSTONE_URL = <span class="hljs-string">&quot;http://%s:5000/v3&quot;</span> % OPENSTACK_HOST<br><br>OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True<br>OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="hljs-string">&quot;Default&quot;</span><br>OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="hljs-string">&quot;user&quot;</span><br>SESSION_ENGINE = <span class="hljs-string">&#x27;django.contrib.sessions.backends.file&#x27;</span><br>OPENSTACK_API_VERSIONS = &#123;<br>    <span class="hljs-string">&quot;identity&quot;</span>: 3,<br>    <span class="hljs-string">&quot;image&quot;</span>: 2,<br>    <span class="hljs-string">&quot;volume&quot;</span>: 3,<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">systemctl reload apache2.service<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">service apache2 restart<br></code></pre></td></tr></table></figure>

<h3 id="11、-创建实例"><a href="#11、-创建实例" class="headerlink" title="11、 创建实例"></a>11、 创建实例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">source</span> admin-openrc<br></code></pre></td></tr></table></figure>

<p>创建一个虚拟机类型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack flavor create --<span class="hljs-built_in">id</span> 0 --vcpus 1 --ram 64 --disk 1 m1.nano<br></code></pre></td></tr></table></figure>

<p>ssh远程登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">. demo-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">ssh-keygen -q -N <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>-q</code> 选项表示静默模式，即在生成密钥对的过程中不会输出任何提示信息或警告。</li>
<li><code>-N</code> 选项后面可以跟一个密码作为参数。该密码将用于保护生成的私钥文件。如果不指定 <code>-N</code> 参数，则私钥文件将不受密码保护。</li>
</ul>
<p>创建秘钥对</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey<br></code></pre></td></tr></table></figure>

<p>查看秘钥对</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack keypair list<br></code></pre></td></tr></table></figure>

<p>创建类型为<code>provider</code>，名字为<code>public</code>的网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">source</span> admin-openrc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack network create  --share --external \<br>  --provider-physical-network provider \<br>  --provider-network-type flat provider<br></code></pre></td></tr></table></figure>

<p>在<code>public</code>上创建一个子网<code>public_net</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack subnet create --network provider \<br>  --allocation-pool start=10.100.192.50,end=10.100.192.100 \<br>  --dns-nameserver 8.8.8.8 --gateway 10.100.192.1 \<br>  --subnet-range 10.100.192.0/24 provider<br></code></pre></td></tr></table></figure>

<p>添加安全组规则，允许ping和ssh到虚拟机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">source</span> demo-openrc<br></code></pre></td></tr></table></figure>

<p>添加icmp协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack security group rule create --proto icmp default<br></code></pre></td></tr></table></figure>

<p>添加tcp协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack security group rule create --proto tcp --dst-port 22 default<br></code></pre></td></tr></table></figure>

<p>创建内部网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack network create selfservice<br></code></pre></td></tr></table></figure>

<p>创建内部网络子网</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack subnet create --network selfservice \<br>  --dns-nameserver 192.168.3.1 --gateway 192.168.10.1 \<br>  --subnet-range 192.168.10.0/24 selfservice<br></code></pre></td></tr></table></figure>

<p>创建实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">openstack server create --flavor m1.nano --image cirros --nic net-id=3d4fdcc0-25a1-49e8-8f11-4b20bd1fe52e --security-group default vm<br></code></pre></td></tr></table></figure>

<p>修改实例的 Mac 地址并查看 ID 地址的 Port ID</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">neutron port-list<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@controller:~<span class="hljs-comment"># neutron port-list</span><br>neutron CLI is deprecated and will be removed <span class="hljs-keyword">in</span> the Z cycle. Use openstack CLI instead.<br>+--------------------------------------+------+----------------------------------+-------------------+--------------------------------------------------------------------------------------+<br>| <span class="hljs-built_in">id</span>                                   | name | tenant_id                        | mac_address       | fixed_ips                                                                            |<br>+--------------------------------------+------+----------------------------------+-------------------+--------------------------------------------------------------------------------------+<br>| 3a9268d0-56e5-4d30-b81c-6692c50f7648 |      | b9f9c436ebb04a42a9d764e0eab068b5 | fa:16:3e:74:4f:b7 | &#123;<span class="hljs-string">&quot;subnet_id&quot;</span>: <span class="hljs-string">&quot;2326cbde-c3d2-4982-8b00-c29bfe8b11b1&quot;</span>, <span class="hljs-string">&quot;ip_address&quot;</span>: <span class="hljs-string">&quot;10.100.192.88&quot;</span>&#125; |<br>| 638e755f-5bb9-404a-ad7a-8e75ee0c92b9 |      | b9f9c436ebb04a42a9d764e0eab068b5 | fa:16:3e:ff:a0:2e | &#123;<span class="hljs-string">&quot;subnet_id&quot;</span>: <span class="hljs-string">&quot;2326cbde-c3d2-4982-8b00-c29bfe8b11b1&quot;</span>, <span class="hljs-string">&quot;ip_address&quot;</span>: <span class="hljs-string">&quot;10.100.192.50&quot;</span>&#125; |<br>| bfc91685-c9ee-41f9-af5a-d725a944d1b0 |      | b9f9c436ebb04a42a9d764e0eab068b5 | e0:be:03:88:54:e8 | &#123;<span class="hljs-string">&quot;subnet_id&quot;</span>: <span class="hljs-string">&quot;2326cbde-c3d2-4982-8b00-c29bfe8b11b1&quot;</span>, <span class="hljs-string">&quot;ip_address&quot;</span>: <span class="hljs-string">&quot;10.100.192.53&quot;</span>&#125; |<br>| cb90cb52-e95a-4c6e-8e9e-c9afaa700b28 |      | b9f9c436ebb04a42a9d764e0eab068b5 | fa:16:3e:be:42:cf | &#123;<span class="hljs-string">&quot;subnet_id&quot;</span>: <span class="hljs-string">&quot;2326cbde-c3d2-4982-8b00-c29bfe8b11b1&quot;</span>, <span class="hljs-string">&quot;ip_address&quot;</span>: <span class="hljs-string">&quot;10.100.192.96&quot;</span>&#125; |<br>+--------------------------------------+------+----------------------------------+-------------------+--------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure>

<p>查看虚拟机 ID</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nova list<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@controller:~<span class="hljs-comment"># nova list</span><br>+--------------------------------------+---------------+--------+------------+-------------+----------------------+<br>| ID                                   | Name          | Status | Task State | Power State | Networks             |<br>+--------------------------------------+---------------+--------+------------+-------------+----------------------+<br>| d5257795-5ff2-4cce-b430-e7a2b29a62fe | openeuler2209 | ACTIVE | -          | Running     | public=10.100.192.96 |<br>| 8381931e-5114-442d-ba28-a693516f1c4c | vm10          | ACTIVE | -          | Running     | public=10.100.192.53 |<br>| 714588ac-862d-495a-aef1-9d36301fcae7 | vm11          | ACTIVE | -          | Running     | public=10.100.192.88 |<br>+--------------------------------------+---------------+--------+------------+-------------+----------------------+<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nova interface-list <span class="hljs-string">&quot;ID&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@controller:~<span class="hljs-comment"># nova interface-list d5257795-5ff2-4cce-b430-e7a2b29a62fe</span><br>+------------+--------------------------------------+--------------------------------------+---------------+-------------------+-----+<br>| Port State | Port ID                              | Net ID                               | IP addresses  | MAC Addr          | Tag |<br>+------------+--------------------------------------+--------------------------------------+---------------+-------------------+-----+<br>| BUILD      | cb90cb52-e95a-4c6e-8e9e-c9afaa700b28 | 8d3c368e-9b36-4f73-91bc-b0b2d3b6cd14 | 10.100.192.96 | fa:16:3e:be:42:cf | -   |<br>+------------+--------------------------------------+--------------------------------------+---------------+-------------------+-----+<br></code></pre></td></tr></table></figure>

<p>解绑当前 IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nova interface-detach <span class="hljs-string">&quot;ID&quot;</span> <span class="hljs-string">&quot;Port ID&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@controller:~<span class="hljs-comment"># nova interface-detach 8381931e-5114-442d-ba28-a693516f1c4c bfc91685-c9ee-41f9-af5a-d725a944d1b0</span><br></code></pre></td></tr></table></figure>

<p>查看网络 Net-list 和子网 Subnet-list</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">neutron net-list<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">neutron subnet-list<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@controller:~<span class="hljs-comment"># neutron subnet-list</span><br>neutron CLI is deprecated and will be removed <span class="hljs-keyword">in</span> the Z cycle. Use openstack CLI instead.<br>+--------------------------------------+---------------+----------------------------------+-----------------+-----------------------------------------------------+<br>| <span class="hljs-built_in">id</span>                                   | name          | tenant_id                        | cidr            | allocation_pools                                    |<br>+--------------------------------------+---------------+----------------------------------+-----------------+-----------------------------------------------------+<br>| 2326cbde-c3d2-4982-8b00-c29bfe8b11b1 | public_subnet | b9f9c436ebb04a42a9d764e0eab068b5 | 10.100.192.0/24 | &#123;<span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;10.100.192.50&quot;</span>, <span class="hljs-string">&quot;end&quot;</span>: <span class="hljs-string">&quot;10.100.192.100&quot;</span>&#125; |<br>+--------------------------------------+---------------+----------------------------------+-----------------+-----------------------------------------------------+<br></code></pre></td></tr></table></figure>

<p>创建一个 Port 指定 MAC 地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">neutron port-create --fixed-ip subnet_id=2326cbde-c3d2-4982-8b00-c29bfe8b11b1(subnet),ip_address=10.100.192.96 --mac-address e0:be:03:88:54:e9 8d3c368e-9b36-4f73-91bc-b0b2d3b6cd14(net)<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">+-----------------------+--------------------------------------------------------------------------------------+<br>| Field                 | Value                                                                                |<br>+-----------------------+--------------------------------------------------------------------------------------+<br>| admin_state_up        | True                                                                                 |<br>| allowed_address_pairs |                                                                                      |<br>| binding:host_id       |                                                                                      |<br>| binding:profile       | &#123;&#125;                                                                                   |<br>| binding:vif_details   | &#123;&#125;                                                                                   |<br>| binding:vif_type      | unbound                                                                              |<br>| binding:vnic_type     | normal                                                                               |<br>| created_at            | 2023-08-10T05:38:47Z                                                                 |<br>| description           |                                                                                      |<br>| device_id             |                                                                                      |<br>| device_owner          |                                                                                      |<br>| extra_dhcp_opts       |                                                                                      |<br>| fixed_ips             | &#123;<span class="hljs-string">&quot;subnet_id&quot;</span>: <span class="hljs-string">&quot;2326cbde-c3d2-4982-8b00-c29bfe8b11b1&quot;</span>, <span class="hljs-string">&quot;ip_address&quot;</span>: <span class="hljs-string">&quot;10.100.192.96&quot;</span>&#125; |<br>| <span class="hljs-built_in">id</span>                    | 66365266-0487-4898-a39c-25640fd6b5dc                                                 |<br>| mac_address           | e0:be:03:88:54:e9                                                                    |<br>| name                  |                                                                                      |<br>| network_id            | 8d3c368e-9b36-4f73-91bc-b0b2d3b6cd14                                                 |<br>| port_security_enabled | True                                                                                 |<br>| project_id            | b9f9c436ebb04a42a9d764e0eab068b5                                                     |<br>| revision_number       | 1                                                                                    |<br>| security_groups       | e852881b-50fb-4648-8e44-35c2f6d12af3                                                 |<br>| status                | DOWN                                                                                 |<br>| tags                  |                                                                                      |<br>| tenant_id             | b9f9c436ebb04a42a9d764e0eab068b5                                                     |<br>| updated_at            | 2023-08-10T05:38:48Z                                                                 |<br>+-----------------------+--------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure>

<p>把 Port Attach 到虚拟机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nova interface-attach d5257795-5ff2-4cce-b430-e7a2b29a62fe --port-id 66365266-0487-4898-a39c-25640fd6b5dc<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">+------------+--------------------------------------+<br>| Property   | Value                                |<br>+------------+--------------------------------------+<br>| ip_address | 10.100.192.96                        |<br>| mac_addr   | e0:be:03:88:54:e9                    |<br>| net_id     | 8d3c368e-9b36-4f73-91bc-b0b2d3b6cd14 |<br>| port_id    | 66365266-0487-4898-a39c-25640fd6b5dc |<br>| port_state | DOWN                                 |<br>| tag        | -                                    |<br>+------------+--------------------------------------+<br></code></pre></td></tr></table></figure>

<p>Controller</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@controller:~<span class="hljs-comment"># ifconfig </span><br>brq8d3c368e-9b: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.100.192.92  netmask 255.255.254.0  broadcast 10.100.193.255<br>        ether f8:e4:3b:63:eb:2f  txqueuelen 1000  (Ethernet)<br>        RX packets 5915428  bytes 6997533910 (6.9 GB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 5405890  bytes 10408992759 (10.4 GB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500<br>        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255<br>        ether 02:42:1d:8e:3c:d1  txqueuelen 0  (Ethernet)<br>        RX packets 0  bytes 0 (0.0 B)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 0  bytes 0 (0.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>enp2s0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.100.192.79  netmask 255.255.254.0  broadcast 10.100.193.255<br>        inet6 fe80::2bc8:6996:aabc:b44  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether e0:be:03:88:ee:cb  txqueuelen 1000  (Ethernet)<br>        RX packets 4983510  bytes 1342995804 (1.3 GB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 432797  bytes 347422676 (347.4 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>enxf8e43b63eb2f: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.100.192.92  netmask 255.255.254.0  broadcast 10.100.193.255<br>        inet6 fe80::759b:702c:b49a:39ae  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether f8:e4:3b:63:eb:2f  txqueuelen 1000  (Ethernet)<br>        RX packets 2513156  bytes 2952978665 (2.9 GB)<br>        RX errors 0  dropped 917  overruns 0  frame 0<br>        TX packets 1819723  bytes 1557298439 (1.5 GB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        loop  txqueuelen 1000  (Local Loopback)<br>        RX packets 16803159  bytes 10055108231 (10.0 GB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 16803159  bytes 10055108231 (10.0 GB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>tap638e755f-5b: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        ether d2:a8:e4:03:71:4e  txqueuelen 1000  (Ethernet)<br>        RX packets 129  bytes 10944 (10.9 KB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 62611  bytes 4787883 (4.7 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br></code></pre></td></tr></table></figure>

<p>Compute</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@compute2:~<span class="hljs-comment"># ifconfig </span><br>brq8d3c368e-9b: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.100.192.93  netmask 255.255.254.0  broadcast 10.100.193.255<br>        ether 00:e0:4c:68:02:18  txqueuelen 1000  (Ethernet)<br>        RX packets 1710244  bytes 1636482655 (1.6 GB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 1325319  bytes 251080446 (251.0 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>eno1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.100.192.94  netmask 255.255.254.0  broadcast 10.100.193.255<br>        inet6 fe80::1dfe:2a01:4237:a169  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether 80:e8:2c:ca:49:7e  txqueuelen 1000  (Ethernet)<br>        RX packets 492369  bytes 38557253 (38.5 MB)<br>        RX errors 0  dropped 5  overruns 0  frame 0<br>        TX packets 7092  bytes 647907 (647.9 KB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>        device interrupt 16  memory 0xf1100000-f1120000  <br><br>enx00e04c680218: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.100.192.93  netmask 255.255.254.0  broadcast 10.100.193.255<br>        inet6 fe80::d7c4:b50:8ffa:b171  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether 00:e0:4c:68:02:18  txqueuelen 1000  (Ethernet)<br>        RX packets 1869249  bytes 1668190374 (1.6 GB)<br>        RX errors 0  dropped 3135  overruns 0  frame 0<br>        TX packets 1462894  bytes 240742887 (240.7 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;<br>        loop  txqueuelen 1000  (Local Loopback)<br>        RX packets 595201  bytes 46392915 (46.3 MB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 595201  bytes 46392915 (46.3 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>tap3a9268d0-56: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet6 fe80::fc16:3eff:fe74:4fb7  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether fe:16:3e:74:4f:b7  txqueuelen 1000  (Ethernet)<br>        RX packets 1186  bytes 102252 (102.2 KB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 233618  bytes 14976194 (14.9 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>tap66365266-04: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet6 fe80::fcbe:3ff:fe88:54e9  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether fe:be:03:88:54:e9  txqueuelen 1000  (Ethernet)<br>        RX packets 3737  bytes 271987 (271.9 KB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 38787  bytes 33210607 (33.2 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500<br>        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255<br>        ether 52:54:00:5c:40:e6  txqueuelen 1000  (Ethernet)<br>        RX packets 0  bytes 0 (0.0 B)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 0  bytes 0 (0.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br></code></pre></td></tr></table></figure>

<h3 id="Bug-总结"><a href="#Bug-总结" class="headerlink" title="Bug 总结"></a>Bug 总结</h3><p><code>subprocess installed post-installation script returned error exit status 10</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">rm</span> /var/lib/dpkg/info/r-base-core*<br>sudo dpkg --configure -D 777 r-base-core<br>sudo apt -f install<br></code></pre></td></tr></table></figure>

<p><code>openstack通过dashboard云主机控制台访问时异常</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/nova/nova.conf<br><br><br>[vnc] <br>enabled = True <br>vncserver_listen = 0.0.0.0 <br>vncserver_proxyclient_address = <span class="hljs-variable">$my_ip</span> <br>novncproxy_base_url = http://controller:6080/vnc_auto.html<br><br><span class="hljs-comment"># controller 修改为具体的 IP</span><br></code></pre></td></tr></table></figure>

<p><code>Openstack Nova Failed to allocate network(s)</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/nova/nova.conf<br><br><span class="hljs-comment">#Fail instance boot if vif plugging fails  </span><br>vif_plugging_is_fatal = False  <br><br><span class="hljs-comment">#Number of seconds to wait for neutron vif  </span><br><span class="hljs-comment">#plugging events to arrive before continuing or failing  </span><br><span class="hljs-comment">#(see vif_plugging_is_fatal). If this is set to zero and  </span><br><span class="hljs-comment">#vif_plugging_is_fatal is False, events should not be expected to arrive at all.  </span><br>vif_plugging_timeout = 0  <br></code></pre></td></tr></table></figure>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hhsh/p/16414025.html#openstack_125">https://www.cnblogs.com/hhsh/p/16414025.html#openstack_125</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/w975121565/article/details/127460218">https://blog.csdn.net/w975121565/article/details/127460218</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zuopiezia/article/details/118972094">https://blog.csdn.net/zuopiezia/article/details/118972094</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/omgasw/p/12023433.html">https://www.cnblogs.com/omgasw/p/12023433.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weiqing1995/article/details/81908023">https://blog.csdn.net/weiqing1995/article/details/81908023</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/OpenStack/" class="category-chain-item">OpenStack</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%95%B4%E7%90%86/">#整理</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>部署双节点X86OpenStack集群</div>
      <div>http://example.com/2023/08/10/部署双节点X86OpenStack集群/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>GeorgyKwe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年8月10日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/08/11/%E5%9F%BA%E4%BA%8EUbuntu%E9%83%A8%E7%BD%B2%E5%A4%9A%E8%8A%82%E7%82%B9k8s%E9%9B%86%E7%BE%A4/" title="基于Ubuntu部署多节点k8s集群">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">基于Ubuntu部署多节点k8s集群</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/05/31/%E4%BA%91%E6%9C%8D%E5%8A%A1/" title="IasS、PasS、SasS 云服务区别">
                        <span class="hidden-mobile">IasS、PasS、SasS 云服务区别</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
    
      
            
                  
                      <span id="busuanzi_container_site_uv">
                        本站访客数<span id="busuanzi_value_site_uv"></span>人次
                      </span>
</div>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
